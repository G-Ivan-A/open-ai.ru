// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User roles enum
enum UserRole {
  STARTUP      // Стартап
  SPECIALIST   // Специалист
  SME          // МСП (малое/среднее предприятие)
  ADMIN        // Администратор
}

// Application status enum
enum ApplicationStatus {
  NEW              // Новая заявка
  IN_REVIEW        // На рассмотрении
  ASSIGNED         // Назначен специалист
  IN_PROGRESS      // В работе
  COMPLETED        // Завершена
  REJECTED         // Отклонена
  CANCELLED        // Отменена пользователем
}

// Application urgency level
enum UrgencyLevel {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// Project status enum
enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  COMPLETED
  ON_HOLD
  CANCELLED
}

// Main User model
model User {
  id                String              @id @default(uuid())
  email             String              @unique
  passwordHash      String
  name              String
  role              UserRole
  expertise         String[]            // Array of expertise areas
  contactInfo       Json?               // Phone, telegram, etc.
  reputationPoints  Int                 @default(0)
  bio               String?
  avatar            String?             // URL to avatar image
  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  // Relations
  profile           UserProfile?
  cases             Case[]
  projects          Project[]
  applications      Application[]
  reputationHistory ReputationHistory[]

  @@index([email])
  @@index([role])
  @@map("users")
}

// Extended user profile information
model UserProfile {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Startup specific fields
  companyName     String?
  companySize     String?
  foundedYear     Int?
  website         String?

  // Specialist specific fields
  yearsExperience Int?
  certifications  String[]
  portfolio       Json?    // Links to work samples

  // SME specific fields
  businessType    String?
  industry        String?
  employeeCount   Int?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("user_profiles")
}

// Reputation tracking history
model ReputationHistory {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  points      Int      // Can be positive or negative
  reason      String   // Description of why points were awarded
  sourceType  String   // "project_completion", "review", "contribution", etc.
  sourceId    String?  // ID of related entity (project, review, etc.)
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
  @@map("reputation_history")
}

// AI Solution Implementation Application
model Application {
  id                  String            @id @default(uuid())
  userId              String
  user                User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Contact Information
  contactName         String
  contactEmail        String
  contactPhone        String?

  // Business Information
  businessDescription String            @db.Text
  companyName         String?
  industry            String

  // Automation Goals
  automationGoal      String            @db.Text
  targetProcess       String            @db.Text
  expectedResults     String?           @db.Text

  // Budget and Timeline
  budget              String?           // Range or specific amount
  timeline            String?           // Expected implementation timeframe
  urgency             UrgencyLevel      @default(MEDIUM)

  // Additional Information
  additionalComments  String?           @db.Text
  attachments         String[]          // URLs to uploaded files

  // Status Tracking
  status              ApplicationStatus @default(NEW)
  assignedTo          String?           // Admin/specialist who took the case
  adminNotes          String?           @db.Text

  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("applications")
}

// Case studies / success stories
model Case {
  id          String   @id @default(uuid())
  title       String
  description String   @db.Text
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  industry    String
  results     Json?    // Metrics and outcomes
  isPublic    Boolean  @default(false)
  tags        String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([isPublic])
  @@map("cases")
}

// Projects for collaboration
model Project {
  id          String        @id @default(uuid())
  title       String
  description String        @db.Text
  ownerId     String
  owner       User          @relation(fields: [ownerId], references: [id])
  status      ProjectStatus @default(PLANNING)
  startDate   DateTime?
  endDate     DateTime?
  tags        String[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([ownerId])
  @@index([status])
  @@map("projects")
}
